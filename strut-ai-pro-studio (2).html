<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strut AI - Professional Studio</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


        :root {
            --primary-red: #DC143C;
            --dark-red: #8B0000;
            --bg-main: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-panel: rgba(10, 10, 10, 0.95);
            --border-color: rgba(220, 20, 60, 0.3);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);
        }


        body {
            background: var(--bg-main);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
        }


        /* Professional Studio Layout */
        .pro-studio {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }


        /* Top Bar with Token System */
        .studio-header {
            height: 60px;
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }


        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }


        .studio-logo {
            font-size: 18px;
            font-weight: 900;
            color: var(--primary-red);
            cursor: pointer;
            letter-spacing: -0.5px;
        }


        .pro-badge {
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }


        .studio-title {
            font-size: 14px;
            color: var(--text-muted);
        }


        /* Token Meter */
        .token-meter {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }


        .token-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }


        .token-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }


        .token-count {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-red);
        }


        .token-bar-container {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }


        .token-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-red), var(--dark-red));
            transition: width 0.3s ease;
        }


        .session-timer {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }


        .timer-dot {
            width: 8px;
            height: 8px;
            background: var(--primary-red);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }


        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }


        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }


        .header-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .header-btn:hover {
            background: rgba(220, 20, 60, 0.2);
            border-color: rgba(220, 20, 60, 0.5);
            transform: translateY(-1px);
        }


        .header-btn:active {
            transform: translateY(0);
        }


        .header-btn.primary {
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border: none;
        }


        .header-btn.primary:hover {
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.4);
        }


        .collab-avatars {
            display: flex;
            margin-left: 8px;
        }


        .collab-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border: 2px solid var(--bg-main);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            margin-left: -10px;
        }


        .collab-avatar:first-child {
            margin-left: 0;
        }


        /* Main Content Area */
        .studio-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }


        /* Left Panel - Creative Direction */
        .left-panel {
            flex: 0 0 280px;
            display: flex;
            flex-direction: column;
            background: var(--bg-panel);
            border-right: 1px solid rgba(220, 20, 60, 0.2);
        }


        .left-panel-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }


        .left-tab {
            flex: 1;
            padding: 12px 8px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }


        .left-tab:hover {
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.02);
        }


        .left-tab.active {
            color: var(--primary-red);
            border-bottom-color: var(--primary-red);
            background: rgba(220, 20, 60, 0.05);
        }


        .left-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }


        .left-panel-content.active {
            display: block;
        }


        /* Canvas Area */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(220, 20, 60, 0.2);
        }


        .canvas-toolbar {
            height: 50px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }


        .toolbar-group {
            display: flex;
            gap: 5px;
        }


        .toolbar-btn {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }


        .toolbar-btn:hover {
            background: rgba(220, 20, 60, 0.2);
            transform: translateY(-1px);
        }


        .toolbar-btn.active {
            background: var(--primary-red);
            border-color: var(--primary-red);
        }


        .quality-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }


        .quality-selector select {
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 11px;
            cursor: pointer;
        }


        .viewport-3d {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--bg-secondary);
            overflow: hidden;
        }


        .model-preview {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }


        .model-preview img {
            height: 100%;
            width: 100%;
            object-fit: contain;
            object-position: center;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.5));
        }


        /* Viewport Overlays */
        .viewport-overlays {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }


        .overlay-toggle {
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .overlay-toggle.active {
            background: rgba(220, 20, 60, 0.3);
            border-color: var(--primary-red);
            color: var(--text-primary);
        }


        .viewport-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }


        .view-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .view-btn:hover {
            background: rgba(220, 20, 60, 0.2);
        }


        .view-btn.active {
            background: var(--primary-red);
            border-color: var(--primary-red);
            color: var(--text-primary);
        }


        .canvas-footer {
            height: 50px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }


        /* Cost Estimator */
        .cost-estimator {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }


        .cost-label {
            font-size: 11px;
            color: var(--text-muted);
        }


        .cost-value {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary-red);
        }


        .enhance-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border: none;
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .enhance-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.5);
        }


        /* Right Control Panel */
        .control-panel {
            flex: 0 0 320px;
            display: flex;
            flex-direction: column;
            background: var(--bg-panel);
        }


        .panel-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }


        .panel-tab {
            flex: 1;
            padding: 15px 10px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }


        .panel-tab:hover {
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.02);
        }


        .panel-tab.active {
            color: var(--primary-red);
            border-bottom-color: var(--primary-red);
            background: rgba(220, 20, 60, 0.05);
        }


        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }


        .panel-content.active {
            display: block;
        }


        .panel-content::-webkit-scrollbar {
            width: 6px;
        }


        .panel-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }


        .panel-content::-webkit-scrollbar-thumb {
            background: rgba(220, 20, 60, 0.5);
            border-radius: 3px;
        }


        .control-section {
            margin-bottom: 30px;
        }


        .control-section h3 {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--primary-red);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }


        .token-cost-badge {
            padding: 2px 6px;
            background: rgba(220, 20, 60, 0.2);
            border-radius: 4px;
            font-size: 9px;
            color: var(--primary-red);
        }


        /* Model Library */
        .model-library {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }


        .model-card {
            aspect-ratio: 3/4;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }


        .model-card:hover {
            border-color: var(--primary-red);
            transform: translateY(-2px);
        }


        .model-card.active {
            border-color: var(--primary-red);
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);
        }


        .model-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }


        .model-card-label {
            position: absolute;
            bottom: 8px;
            left: 8px;
            font-size: 11px;
            font-weight: 600;
            z-index: 1;
        }


        /* Enhanced Controls */
        .slider-control {
            margin-bottom: 20px;
        }


        .slider-control label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }


        .slider-value {
            color: var(--primary-red);
            font-variant-numeric: tabular-nums;
        }


        .slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }


        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.5);
            transition: all 0.2s ease;
        }


        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }


        .studio-select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .studio-select:hover {
            border-color: rgba(220, 20, 60, 0.3);
        }


        .studio-select:focus {
            outline: none;
            border-color: var(--primary-red);
        }


        /* Button Grids */
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }


        .btn-grid.three-col {
            grid-template-columns: repeat(3, 1fr);
        }


        .grid-btn {
            padding: 12px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }


        .grid-btn:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: rgba(220, 20, 60, 0.3);
            transform: translateY(-1px);
        }


        .grid-btn.active {
            background: rgba(220, 20, 60, 0.2);
            border-color: var(--primary-red);
            color: var(--text-primary);
        }


        /* Color Picker */
        .color-picker-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }


        .color-input {
            width: 50px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
        }


        .color-presets {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            flex: 1;
        }


        .color-swatch {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .color-swatch:hover {
            transform: scale(1.1);
        }


        .color-swatch.active {
            border-color: var(--primary-red);
            box-shadow: 0 0 12px rgba(220, 20, 60, 0.5);
        }


        /* Upload Button */
        .upload-btn {
            width: 100%;
            padding: 14px;
            background: rgba(220, 20, 60, 0.1);
            border: 2px dashed rgba(220, 20, 60, 0.5);
            border-radius: 8px;
            color: var(--primary-red);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }


        .upload-btn:hover {
            background: rgba(220, 20, 60, 0.2);
            border-color: var(--primary-red);
        }


        /* Checkbox Options */
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            cursor: pointer;
        }


        .checkbox-option input[type="checkbox"] {
            accent-color: var(--primary-red);
            width: 18px;
            height: 18px;
            cursor: pointer;
        }


        .checkbox-option span {
            font-size: 13px;
            color: var(--text-secondary);
        }


        .checkbox-option:hover span {
            color: var(--text-primary);
        }


        /* Text Input */
        .text-input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }


        .text-input:hover {
            border-color: rgba(220, 20, 60, 0.3);
        }


        .text-input:focus {
            outline: none;
            border-color: var(--primary-red);
        }


        .text-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }


        /* Export Options */
        .export-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }


        .export-option:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: rgba(220, 20, 60, 0.3);
        }


        .export-option input[type="radio"] {
            accent-color: var(--primary-red);
        }


        .export-option span {
            font-size: 13px;
            color: var(--text-secondary);
        }


        /* Action Buttons */
        .action-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary-red), var(--dark-red));
            border: none;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }


        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.5);
        }


        .action-btn:active {
            transform: translateY(0);
        }


        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }


        .action-btn.secondary:hover {
            background: rgba(220, 20, 60, 0.2);
            border-color: rgba(220, 20, 60, 0.5);
        }


        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }


        .modal.show {
            display: flex;
        }


        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }


        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
        }


        .modal-close:hover {
            color: var(--primary-red);
            background: rgba(220, 20, 60, 0.1);
        }


        .modal h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary-red);
        }


        .modal p {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 25px;
        }


        /* Cost Breakdown */
        .cost-breakdown {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }


        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }


        .cost-item:last-child {
            border-bottom: none;
            font-weight: 700;
            color: var(--primary-red);
        }


        .cost-item-label {
            font-size: 13px;
            color: var(--text-secondary);
        }


        .cost-item-value {
            font-size: 13px;
            color: var(--text-primary);
        }


        /* Notifications */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--primary-red);
            border-radius: 8px;
            padding: 16px 20px;
            color: var(--text-primary);
            font-size: 13px;
            z-index: 4000;
            animation: slideInRight 0.3s ease;
            display: none;
        }


        .notification.show {
            display: block;
        }


        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }


        /* Version Timeline */
        .version-timeline {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }


        .version-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }


        .version-item:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--primary-red);
        }


        .version-item.active {
            border-color: var(--primary-red);
            background: rgba(220, 20, 60, 0.2);
        }


        .version-time {
            font-size: 11px;
            color: var(--text-muted);
        }


        .version-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }


        /* Responsive */
        @media (max-width: 1200px) {
            .left-panel {
                flex: 0 0 240px;
            }
            .control-panel {
                flex: 0 0 280px;
            }
        }


        /* Loading State */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }


        .loading-overlay.show {
            display: flex;
        }


        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }


        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Real-time editing canvas wrapper */
        .model-preview {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .model-preview img {
            height: 100%;
            width: 100%;
            object-fit: contain;
            object-position: center;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.5));
            transition: filter 0.15s ease;
            display: block;
        }

        /* Vignette overlay */
        .vignette-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            opacity: 0;
        }

        /* Gradient background options */
        .bg-gradient-preview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        .bg-swatch {
            height: 36px;
            border-radius: 6px;
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .bg-swatch:hover, .bg-swatch.active {
            border-color: var(--primary-red);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(220,20,60,0.4);
        }

        /* Color tint overlay on image */
        .color-tint-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            border-radius: 4px;
            mix-blend-mode: color;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        /* Adjustment sliders section highlight */
        .control-section.live {
            border-left: 2px solid var(--primary-red);
            padding-left: 12px;
        }
        .live-indicator {
            display: inline-block;
            width: 6px; height: 6px;
            background: #00ff88;
            border-radius: 50%;
            margin-left: 6px;
            animation: pulse 2s infinite;
        }

        /* Reset button for adjustments */
        .reset-adjustments {
            width: 100%;
            padding: 8px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: rgba(255,255,255,0.5);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
            text-align: center;
        }
        .reset-adjustments:hover {
            background: rgba(220,20,60,0.15);
            border-color: rgba(220,20,60,0.4);
            color: #fff;
        }

    </style>
</head>
<body>
    <div class="pro-studio">
        <!-- Header -->
        <div class="studio-header">
            <div class="header-left">
                <div class="studio-logo" onclick="window.location.href='/'" style="cursor: pointer;">STRUT AI</div>
                <span class="pro-badge">PRO STUDIO</span>
                <div class="studio-title">Professional Studio</div>
            </div>


            <div style="display: flex; align-items: center; gap: 20px;">
                <!-- Token Meter -->
                <div class="token-meter">
                    <div class="token-info">
                        <div class="token-label">Tokens</div>
                        <div class="token-count" id="tokenCount">850 / 1000</div>
                    </div>
                    <div class="token-bar-container">
                        <div class="token-bar" id="tokenBar" style="width: 85%"></div>
                    </div>
                </div>


                <!-- Session Timer -->
                <div class="session-timer">
                    <div class="timer-dot"></div>
                    <span id="sessionTimer">42:18 remaining</span>
                </div>


                <div class="header-actions">
                    <button class="header-btn" onclick="showVersionModal()">
                        ðŸ“‹ Versions
                    </button>
                    <button class="header-btn" onclick="showTeamModal()">
                        ðŸ‘¥ Team
                        <div class="collab-avatars">
                            <div class="collab-avatar">JD</div>
                            <div class="collab-avatar">SM</div>
                            <div class="collab-avatar">+</div>
                        </div>
                    </button>
                    <button class="header-btn" onclick="undo()">â†¶ Undo</button>
                    <button class="header-btn" onclick="redo()">â†· Redo</button>
                    <button class="header-btn" onclick="saveVersion()">ðŸ’¾ Save</button>
                    <button class="header-btn primary" onclick="showRenderModal()">âœ¨ Render</button>
                </div>
            </div>
        </div>


        <!-- Main Content -->
        <div class="studio-content">
            <!-- Left Panel - Creative Direction -->
            <div class="left-panel">
                <div class="left-panel-tabs">
                    <button class="left-tab active" onclick="switchLeftPanel(event, 'model')">Model</button>
                    <button class="left-tab" onclick="switchLeftPanel(event, 'pose')">Pose</button>
                    <button class="left-tab" onclick="switchLeftPanel(event, 'garment')">Garment</button>
                </div>


                <!-- Model Panel -->
                <div class="left-panel-content active" id="modelLeftPanel">
                    <div class="control-section">
                        <h3>Model Library</h3>
                        <div class="model-library">
                            <div class="model-card active" onclick="selectModel(this)">
                                <div class="model-card-label">Model A</div>
                            </div>
                            <div class="model-card" onclick="selectModel(this)">
                                <div class="model-card-label">Model B</div>
                            </div>
                            <div class="model-card" onclick="selectModel(this)">
                                <div class="model-card-label">Model C</div>
                            </div>
                            <div class="model-card" onclick="selectModel(this)">
                                <div class="model-card-label">+ New</div>
                            </div>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Body Type <span class="token-cost-badge">MEDIUM</span></h3>
                        <select class="studio-select" onchange="updateTokenCost()">
                            <option>Athletic</option>
                            <option selected>Average</option>
                            <option>Hourglass</option>
                            <option>Pear</option>
                            <option>Plus Size</option>
                        </select>
                    </div>


                    <div class="control-section">
                        <h3>Body Proportions <span class="token-cost-badge">HIGH</span></h3>
                        <div class="slider-control">
                            <label>
                                <span>Height</span>
                                <span class="slider-value">5'10"</span>
                            </label>
                            <input type="range" min="60" max="78" value="70" class="slider" oninput="updateSlider(this, 'height')" onchange="updateTokenCost()">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Bust</span>
                                <span class="slider-value">34"</span>
                            </label>
                            <input type="range" min="28" max="48" value="34" class="slider" oninput="updateSlider(this, 'bust')" onchange="updateTokenCost()">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Waist</span>
                                <span class="slider-value">24"</span>
                            </label>
                            <input type="range" min="22" max="42" value="24" class="slider" oninput="updateSlider(this, 'waist')" onchange="updateTokenCost()">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Hips</span>
                                <span class="slider-value">35"</span>
                            </label>
                            <input type="range" min="30" max="50" value="35" class="slider" oninput="updateSlider(this, 'hips')" onchange="updateTokenCost()">
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Appearance <span class="token-cost-badge">LOW</span></h3>
                        <div class="slider-control">
                            <label>
                                <span>Skin Tone</span>
                                <span class="slider-value">Medium</span>
                            </label>
                            <input type="range" min="0" max="100" value="40" class="slider" oninput="updateSlider(this, 'skin')" onchange="updateTokenCost()">
                        </div>
                        <select class="studio-select" style="margin-top: 10px;" onchange="updateTokenCost()">
                            <option>18-25 years</option>
                            <option selected>25-35 years</option>
                            <option>35-45 years</option>
                            <option>45+ years</option>
                        </select>
                    </div>


                    <div class="control-section">
                        <h3>Expression</h3>
                        <div class="slider-control">
                            <label>
                                <span>Eye Openness</span>
                                <span class="slider-value">50%</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Smile</span>
                                <span class="slider-value">30%</span>
                            </label>
                            <input type="range" min="0" max="100" value="30" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                    </div>
                </div>


                <!-- Pose Panel -->
                <div class="left-panel-content" id="poseLeftPanel">
                    <div class="control-section">
                        <h3>Pose Library <span class="token-cost-badge">LOW</span></h3>
                        <div class="btn-grid">
                            <button class="grid-btn active" onclick="selectGridBtn(this)">Standing</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Walking</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Editorial</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Streetwear</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">E-commerce</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Runway</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Sitting</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Leaning</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Fine-Tune Pose</h3>
                        <div class="slider-control">
                            <label>
                                <span>Head Tilt</span>
                                <span class="slider-value">0Â°</span>
                            </label>
                            <input type="range" min="-45" max="45" value="0" class="slider" oninput="updateSlider(this, 'degrees')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Shoulder Angle</span>
                                <span class="slider-value">0Â°</span>
                            </label>
                            <input type="range" min="-30" max="30" value="0" class="slider" oninput="updateSlider(this, 'degrees')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Hip Shift</span>
                                <span class="slider-value">0%</span>
                            </label>
                            <input type="range" min="-50" max="50" value="0" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Weight Distribution</span>
                                <span class="slider-value">50/50</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" oninput="updateSlider(this, 'weight')">
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Motion Preview <span class="token-cost-badge">HIGH</span></h3>
                        <button class="action-btn secondary">â–¶ Walking Animation</button>
                        <button class="action-btn secondary" style="margin-top: 10px;">â†» 360Â° Turn</button>
                        <button class="action-btn secondary" style="margin-top: 10px;">ðŸŽ¬ Turntable</button>
                        <button class="action-btn secondary" style="margin-top: 10px;">ðŸš¶ Runway Walk</button>
                    </div>
                </div>


                <!-- Garment Panel -->
                <div class="left-panel-content" id="garmentLeftPanel">
                    <div class="control-section">
                        <h3>Upload Garment</h3>
                        <button class="upload-btn" onclick="document.getElementById('garmentUpload').click()">
                            ðŸ“¤ Upload Files (.obj, .fbx, .gltf)
                        </button>
                        <input type="file" id="garmentUpload" style="display: none;" accept=".obj,.fbx,.gltf" onchange="handleGarmentUpload(this)">
                    </div>


                    <div class="control-section">
                        <h3>Garment Color</h3>
                        <div class="color-picker-row">
                            <input type="color" value="#DC143C" class="color-input" onchange="updateGarmentColor(this)">
                            <div class="color-presets">
                                <button class="color-swatch" style="background: #000000" onclick="selectColor(this, '#000000')"></button>
                                <button class="color-swatch" style="background: #FFFFFF" onclick="selectColor(this, '#FFFFFF')"></button>
                                <button class="color-swatch active" style="background: #DC143C" onclick="selectColor(this, '#DC143C')"></button>
                                <button class="color-swatch" style="background: #0066CC" onclick="selectColor(this, '#0066CC')"></button>
                                <button class="color-swatch" style="background: #2E7D32" onclick="selectColor(this, '#2E7D32')"></button>
                                <button class="color-swatch" style="background: #FFD700" onclick="selectColor(this, '#FFD700')"></button>
                            </div>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Fabric Texture</h3>
                        <div class="btn-grid">
                            <button class="grid-btn active" onclick="selectGridBtn(this)">Cotton</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Denim</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Leather</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Silk</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Knit</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Tech</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Fabric Properties</h3>
                        <div class="slider-control">
                            <label>
                                <span>Stiffness</span>
                                <span class="slider-value">50%</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Flow Behavior</span>
                                <span class="slider-value">60%</span>
                            </label>
                            <input type="range" min="0" max="100" value="60" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Stretch</span>
                                <span class="slider-value">30%</span>
                            </label>
                            <input type="range" min="0" max="100" value="30" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Wrinkle Density</span>
                                <span class="slider-value">40%</span>
                            </label>
                            <input type="range" min="0" max="100" value="40" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Physics Simulation</h3>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateTokenCost()">
                            <span>Realistic Draping</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateTokenCost()">
                            <span>Gravity Simulation</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateTokenCost()">
                            <span>Wrinkle Generation</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateTokenCost()">
                            <span>Collision Detection</span>
                        </label>
                    </div>
                </div>
            </div>


            <!-- Canvas Area -->
            <div class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="toolbar-group">
                        <button class="toolbar-btn" title="Undo" onclick="undo()">â†¶</button>
                        <button class="toolbar-btn" title="Redo" onclick="redo()">â†·</button>
                        <button class="toolbar-btn" title="Reset" onclick="resetCanvas()">âŸ³</button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn active" title="Select">âŒ–</button>
                        <button class="toolbar-btn" title="Move">âœ¥</button>
                        <button class="toolbar-btn" title="Rotate">â†»</button>
                        <button class="toolbar-btn" title="Scale">â¤¡</button>
                    </div>
                    <div class="quality-selector">
                        <span>Quality:</span>
                        <select onchange="updateQuality(this)">
                            <option value="draft">Draft</option>
                            <option value="production" selected>Production</option>
                            <option value="print">Print-Ready</option>
                        </select>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" title="Zoom In" onclick="zoomIn()">+</button>
                        <button class="toolbar-btn" title="Zoom Out" onclick="zoomOut()">âˆ’</button>
                        <button class="toolbar-btn" title="Fit" onclick="fitView()">â›¶</button>
                    </div>
                </div>


                <div class="viewport-3d" id="viewport">
                    <!-- Viewport Overlays -->
                    <div class="viewport-overlays">
                        <button class="overlay-toggle" onclick="toggleOverlay(this, 'lighting')">ðŸ’¡ Lighting</button>
                        <button class="overlay-toggle" onclick="toggleOverlay(this, 'shadows')">ðŸŒ“ Shadows</button>
                        <button class="overlay-toggle" onclick="toggleOverlay(this, 'guides')">ðŸ“ Guides</button>
                        <button class="overlay-toggle" onclick="toggleOverlay(this, 'fit')">âš ï¸ Fit Warnings</button>
                    </div>


                    <div class="model-preview" id="modelPreviewWrapper">
                        <img src="https://i.imgur.com/zCukqmO.png" alt="Model" id="modelImage">
                        <div class="vignette-overlay" id="vignetteOverlay"></div>
                        <div class="color-tint-overlay" id="colorTintOverlay"></div>
                    </div>


                    <div class="viewport-controls">
                        <button class="view-btn active" onclick="selectView(this, 'front')">Front</button>
                        <button class="view-btn" onclick="selectView(this, 'side')">Side</button>
                        <button class="view-btn" onclick="selectView(this, 'back')">Back</button>
                        <button class="view-btn" onclick="selectView(this, 'three-quarter')">3/4 View</button>
                    </div>


                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-spinner"></div>
                    </div>
                </div>


                <div class="canvas-footer">
                    <div class="cost-estimator">
                        <span class="cost-label">Estimated Cost:</span>
                        <span class="cost-value" id="estimatedCost">45 tokens</span>
                    </div>
                    <button class="enhance-btn" onclick="aiEnhance()">âœ¨ AI Enhance</button>
                </div>
            </div>


            <!-- Right Control Panel -->
            <div class="control-panel">
                <div class="panel-tabs">
                    <button class="panel-tab active" onclick="switchPanel(event, 'camera')">Camera</button>
                    <button class="panel-tab" onclick="switchPanel(event, 'lighting')">Lighting</button>
                    <button class="panel-tab" onclick="switchPanel(event, 'scene')">Scene</button>
                    <button class="panel-tab" onclick="switchPanel(event, 'export')">Export</button>
                </div>


                <!-- Camera Panel -->
                <div class="panel-content active" id="cameraPanel">
                    <div class="control-section">
                        <h3>Lens Simulation <span class="token-cost-badge">LOW</span></h3>
                        <div class="btn-grid three-col">
                            <button class="grid-btn" onclick="selectGridBtn(this)">35mm</button>
                            <button class="grid-btn active" onclick="selectGridBtn(this)">50mm</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">85mm</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Camera Controls</h3>
                        <div class="slider-control">
                            <label>
                                <span>Camera Angle</span>
                                <span class="slider-value">0Â°</span>
                            </label>
                            <input type="range" min="0" max="360" value="0" class="slider" oninput="updateSlider(this, 'degrees')" onchange="updateTokenCost()">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Zoom Level</span>
                                <span class="slider-value">50%</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Depth of Field</span>
                                <span class="slider-value">30%</span>
                            </label>
                            <input type="range" min="0" max="100" value="30" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Framing Presets</h3>
                        <div class="btn-grid">
                            <button class="grid-btn active" onclick="selectGridBtn(this)">Full Body</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">3/4 Length</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Waist Up</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Close-up</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Crop Ratio</h3>
                        <select class="studio-select">
                            <option>1:1 Square</option>
                            <option>4:5 Portrait</option>
                            <option selected>3:4 Editorial</option>
                            <option>16:9 Landscape</option>
                            <option>9:16 Story</option>
                        </select>
                    </div>


                    <div class="control-section">
                        <h3>Professional Touch</h3>
                        <label class="checkbox-option">
                            <input type="checkbox" checked>
                            <span>Perspective Correction</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Editorial Crop Bias</span>
                        </label>
                    </div>
                </div>


                <!-- Lighting Panel -->
                <div class="panel-content" id="lightingPanel">
                    <div class="control-section">
                        <h3>Lighting Presets <span class="token-cost-badge">MEDIUM</span></h3>
                        <div class="btn-grid">
                            <button class="grid-btn active" onclick="applyLightingPreset(this, 'studio')">Studio</button>
                            <button class="grid-btn" onclick="applyLightingPreset(this, 'natural')">Natural</button>
                            <button class="grid-btn" onclick="applyLightingPreset(this, 'dramatic')">Dramatic</button>
                            <button class="grid-btn" onclick="applyLightingPreset(this, 'soft')">Soft</button>
                            <button class="grid-btn" onclick="applyLightingPreset(this, 'golden')">Golden Hour</button>
                            <button class="grid-btn" onclick="applyLightingPreset(this, 'highkey')">High Key</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Light Rig</h3>
                        <label class="checkbox-option">
                            <input type="checkbox" checked>
                            <span>Key Light</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" checked>
                            <span>Fill Light</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Rim Light</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Hair Light</span>
                        </label>
                    </div>


                    <div class="control-section live">
                        <h3>Light Properties <span class="live-indicator"></span></h3>
                        <div class="slider-control">
                            <label>
                                <span>Exposure</span>
                                <span class="slider-value" id="exposureVal">100%</span>
                            </label>
                            <input type="range" min="20" max="200" value="100" class="slider" id="exposureSlider" oninput="updateAdjustment(this, 'brightness', 'exposureVal', '%')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Light Softness / Blur BG</span>
                                <span class="slider-value" id="softVal">0%</span>
                            </label>
                            <input type="range" min="0" max="100" value="0" class="slider" oninput="updateLightSoftness(this)">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Shadow Intensity</span>
                                <span class="slider-value" id="shadowVal">50%</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" oninput="updateShadow(this)">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Light Direction</span>
                                <span class="slider-value">45Â°</span>
                            </label>
                            <input type="range" min="0" max="360" value="45" class="slider" oninput="updateSlider(this, 'degrees')">
                        </div>
                    </div>

                    <div class="control-section live">
                        <h3>Skin Tone Optimization <span class="live-indicator"></span></h3>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateFilters()">
                            <span>Auto-Balance Skin Tones</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" checked onchange="updateFilters()">
                            <span>Preserve Highlights</span>
                        </label>
                        <div class="slider-control">
                            <label>
                                <span>Warmth</span>
                                <span class="slider-value" id="lightWarmthVal">50%</span>
                            </label>
                            <input type="range" min="0" max="100" value="50" class="slider" id="lightWarmthSlider" oninput="updateLightWarmth(this)">
                        </div>
                    </div>
                </div>


                <!-- Scene Panel -->
                <div class="panel-content" id="scenePanel">
                    <div class="control-section">
                        <h3>Background <span class="token-cost-badge">MEDIUM</span></h3>
                        <div class="btn-grid">
                            <button class="grid-btn active" onclick="setBackground(this, 'studio')">Studio</button>
                            <button class="grid-btn" onclick="setBackground(this, 'urban')">Urban</button>
                            <button class="grid-btn" onclick="setBackground(this, 'runway')">Runway</button>
                            <button class="grid-btn" onclick="setBackground(this, 'lifestyle')">Lifestyle</button>
                            <button class="grid-btn" onclick="setBackground(this, 'transparent')">Transparent</button>
                            <button class="grid-btn" onclick="setBackground(this, 'custom')">Custom</button>
                        </div>
                        <div class="bg-gradient-preview">
                            <div class="bg-swatch active" style="background: #1a1a1a;" onclick="setBgColor(this, '#1a1a1a')" title="Dark Studio"></div>
                            <div class="bg-swatch" style="background: #f5f5f5;" onclick="setBgColor(this, '#f5f5f5')" title="White Studio"></div>
                            <div class="bg-swatch" style="background: #c8b8a2;" onclick="setBgColor(this, '#c8b8a2')" title="Warm Beige"></div>
                            <div class="bg-swatch" style="background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);" onclick="setBgColor(this, 'linear-gradient(135deg,#0f0c29,#302b63,#24243e)')" title="Night"></div>
                            <div class="bg-swatch" style="background: linear-gradient(135deg,#f8b500,#e94e1b);" onclick="setBgColor(this, 'linear-gradient(135deg,#f8b500,#e94e1b)')" title="Golden Hour"></div>
                            <div class="bg-swatch" style="background: linear-gradient(135deg,#141e30,#243b55);" onclick="setBgColor(this, 'linear-gradient(135deg,#141e30,#243b55)')" title="Deep Ocean"></div>
                            <div class="bg-swatch" style="background: linear-gradient(135deg,#1a1a2e,#DC143C);" onclick="setBgColor(this, 'linear-gradient(135deg,#1a1a2e,#DC143C)')" title="Brand Red"></div>
                            <div class="bg-swatch" style="background: linear-gradient(135deg,#2d5016,#6a9a3a);" onclick="setBgColor(this, 'linear-gradient(135deg,#2d5016,#6a9a3a)')" title="Forest"></div>
                        </div>
                    </div>

                    <div class="control-section live">
                        <h3>Image Adjustments <span class="live-indicator"></span></h3>
                        <button class="reset-adjustments" onclick="resetAllAdjustments()">â†º Reset All Adjustments</button>
                        <div class="slider-control">
                            <label>
                                <span>Brightness</span>
                                <span class="slider-value" id="brightnessVal">100%</span>
                            </label>
                            <input type="range" min="0" max="200" value="100" class="slider" id="brightnessSlider" oninput="updateAdjustment(this, 'brightness', 'brightnessVal', '%')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Contrast</span>
                                <span class="slider-value" id="contrastVal">100%</span>
                            </label>
                            <input type="range" min="0" max="200" value="100" class="slider" id="contrastSlider" oninput="updateAdjustment(this, 'contrast', 'contrastVal', '%')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Saturation</span>
                                <span class="slider-value" id="saturationVal">100%</span>
                            </label>
                            <input type="range" min="0" max="300" value="100" class="slider" id="saturationSlider" oninput="updateAdjustment(this, 'saturate', 'saturationVal', '%')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Hue Rotate</span>
                                <span class="slider-value" id="hueVal">0Â°</span>
                            </label>
                            <input type="range" min="-180" max="180" value="0" class="slider" id="hueSlider" oninput="updateAdjustment(this, 'hue-rotate', 'hueVal', 'deg')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Sharpness</span>
                                <span class="slider-value" id="sharpnessVal">0%</span>
                            </label>
                            <input type="range" min="0" max="100" value="0" class="slider" id="sharpnessSlider" oninput="updateSharpness(this)">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Blur / Soft Focus</span>
                                <span class="slider-value" id="blurVal">0px</span>
                            </label>
                            <input type="range" min="0" max="10" value="0" step="0.1" class="slider" id="blurSlider" oninput="updateAdjustment(this, 'blur', 'blurVal', 'px')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Vignette</span>
                                <span class="slider-value" id="vignetteVal">0%</span>
                            </label>
                            <input type="range" min="0" max="100" value="0" class="slider" id="vignetteSlider" oninput="updateVignette(this)">
                        </div>
                    </div>

                    <div class="control-section live">
                        <h3>Color Grading <span class="live-indicator"></span></h3>
                        <div class="slider-control">
                            <label>
                                <span>Warmth</span>
                                <span class="slider-value" id="warmthVal">0%</span>
                            </label>
                            <input type="range" min="-100" max="100" value="0" class="slider" id="warmthSlider" oninput="updateWarmth(this)">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Tint (Green/Magenta)</span>
                                <span class="slider-value" id="tintVal">0%</span>
                            </label>
                            <input type="range" min="-100" max="100" value="0" class="slider" id="tintSlider" oninput="updateTint(this)">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Sepia</span>
                                <span class="slider-value" id="sepiaVal">0%</span>
                            </label>
                            <input type="range" min="0" max="100" value="0" class="slider" id="sepiaSlider" oninput="updateAdjustment(this, 'sepia', 'sepiaVal', '%')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Grayscale</span>
                                <span class="slider-value" id="grayscaleVal">0%</span>
                            </label>
                            <input type="range" min="0" max="100" value="0" class="slider" id="grayscaleSlider" oninput="updateAdjustment(this, 'grayscale', 'grayscaleVal', '%')">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Look Presets</h3>
                        <div class="btn-grid">
                            <button class="grid-btn" onclick="applyLookPreset(this, 'editorial')">Editorial</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'cinematic')">Cinematic</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'fashion')">Fashion</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'moody')">Moody</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'bright')">Bright & Airy</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'bw')">Black & White</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'vintage')">Vintage</button>
                            <button class="grid-btn" onclick="applyLookPreset(this, 'reset')">â†º Reset</button>
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Environment</h3>
                        <div class="slider-control">
                            <label>
                                <span>Floor Reflection</span>
                                <span class="slider-value">40%</span>
                            </label>
                            <input type="range" min="0" max="100" value="40" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                        <div class="slider-control">
                            <label>
                                <span>Shadow Density</span>
                                <span class="slider-value">60%</span>
                            </label>
                            <input type="range" min="0" max="100" value="60" class="slider" oninput="updateSlider(this, 'percentage')">
                        </div>
                    </div>

                    <div class="control-section">
                        <h3>Brand World (Pro+)</h3>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Lock Lighting</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Lock Color Palette</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Consistent Framing</span>
                        </label>
                    </div>

                    <div class="control-section">
                        <h3>Text Overlays</h3>
                        <input type="text" placeholder="Collection Name" class="text-input">
                        <input type="text" placeholder="Drop Date" class="text-input">
                        <input type="text" placeholder="Price" class="text-input">
                    </div>
                </div>


                <!-- Export Panel -->
                <div class="panel-content" id="exportPanel">
                    <div class="control-section">
                        <h3>Format</h3>
                        <label class="export-option">
                            <input type="radio" name="format" checked>
                            <span>PNG High-Res</span>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="format">
                            <span>PNG Transparent</span>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="format">
                            <span>JPG Optimized</span>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="format">
                            <span>MP4 Turntable</span>
                        </label>
                        <label class="export-option">
                            <input type="radio" name="format">
                            <span>MP4 Walking</span>
                        </label>
                    </div>


                    <div class="control-section">
                        <h3>Resolution</h3>
                        <select class="studio-select">
                            <option>Social (1080x1080)</option>
                            <option>Web HD (1920x1080)</option>
                            <option selected>Print 4K</option>
                            <option>Print 8K</option>
                            <option>Ultra 16K</option>
                        </select>
                    </div>


                    <div class="control-section">
                        <h3>Platform Optimization</h3>
                        <div class="btn-grid">
                            <button class="grid-btn" onclick="selectGridBtn(this)">Instagram</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Shopify</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Etsy</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Website</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Print</button>
                            <button class="grid-btn" onclick="selectGridBtn(this)">Lookbook</button>
                        </div>
                    </div>


                    <div class="control-section">
                        <h3>Batch Export</h3>
                        <label class="checkbox-option">
                            <input type="checkbox" id="exportColors">
                            <span>All color variants (6 colors)</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="exportAngles">
                            <span>All angles (4 views)</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="exportSizes">
                            <span>All sizes (XS-5X)</span>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="exportLookbook">
                            <span>Lookbook layout</span>
                        </label>
                    </div>


                    <div class="control-section">
                        <h3>Watermark</h3>
                        <label class="checkbox-option">
                            <input type="checkbox">
                            <span>Add watermark</span>
                        </label>
                    </div>


                    <button class="action-btn" onclick="exportRender()">ðŸ“¥ Export Final Render</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Render Cost Modal -->
    <div class="modal" id="renderModal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideModal('renderModal')">Ã—</button>
            <h2>Render Preview</h2>
            <p>Review estimated token cost before rendering</p>


            <div class="cost-breakdown">
                <div class="cost-item">
                    <span class="cost-item-label">Base Render</span>
                    <span class="cost-item-value">20 tokens</span>
                </div>
                <div class="cost-item">
                    <span class="cost-item-label">Body Customization</span>
                    <span class="cost-item-value">15 tokens</span>
                </div>
                <div class="cost-item">
                    <span class="cost-item-label">Physics Simulation</span>
                    <span class="cost-item-value">10 tokens</span>
                </div>
                <div class="cost-item">
                    <span class="cost-item-label">Quality: Production</span>
                    <span class="cost-item-value">+0 tokens</span>
                </div>
                <div class="cost-item">
                    <span class="cost-item-label">Total Cost</span>
                    <span class="cost-item-value">45 tokens</span>
                </div>
            </div>


            <div style="margin-bottom: 20px;">
                <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 10px;">
                    Remaining balance: 850 tokens
                </div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.6);">
                    After render: 805 tokens
                </div>
            </div>


            <button class="action-btn" onclick="startRender()">âœ¨ Proceed to Render</button>
            <button class="action-btn secondary" onclick="hideModal('renderModal')" style="margin-top: 10px;">Adjust Settings</button>
        </div>
    </div>


    <!-- Version History Modal -->
    <div class="modal" id="versionModal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideModal('versionModal')">Ã—</button>
            <h2>Version History</h2>
            <p>Compare and restore previous versions</p>


            <div class="version-timeline">
                <div class="version-item active">
                    <div class="version-time">2 minutes ago</div>
                    <div class="version-name">Current Version</div>
                </div>
                <div class="version-item">
                    <div class="version-time">15 minutes ago</div>
                    <div class="version-name">Auto-save v3</div>
                </div>
                <div class="version-item">
                    <div class="version-time">1 hour ago</div>
                    <div class="version-name">Manual save - Red variant</div>
                </div>
                <div class="version-item">
                    <div class="version-time">Yesterday</div>
                    <div class="version-name">Initial setup</div>
                </div>
            </div>


            <button class="action-btn secondary" onclick="hideModal('versionModal')">Close</button>
        </div>
    </div>


    <!-- Team Collaboration Modal -->
    <div class="modal" id="teamModal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideModal('teamModal')">Ã—</button>
            <h2>Team Collaboration</h2>
            <p>Invite team members to work on this project</p>


            <div style="margin-bottom: 25px;">
                <h3 style="font-size: 13px; margin-bottom: 15px; color: rgba(255,255,255,0.7);">Current Members</h3>
                <div style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px; padding: 12px; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="collab-avatar" style="margin: 0;">JD</div>
                        <div style="flex: 1;">
                            <div style="font-size: 13px; font-weight: 600;">John Doe (You)</div>
                            <div style="font-size: 11px; color: rgba(255,255,255,0.5);">Owner</div>
                        </div>
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 8px; padding: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="collab-avatar" style="margin: 0;">SM</div>
                        <div style="flex: 1;">
                            <div style="font-size: 13px; font-weight: 600;">Sarah Miller</div>
                            <div style="font-size: 11px; color: rgba(255,255,255,0.5);">Editor</div>
                        </div>
                        <button style="padding: 6px 12px; background: rgba(255,0,0,0.1); border: 1px solid rgba(255,0,0,0.3); border-radius: 4px; color: #ff4444; font-size: 11px; cursor: pointer;">Remove</button>
                    </div>
                </div>
            </div>


            <label style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 8px; display: block;">Email Address</label>
            <input type="email" class="text-input" placeholder="teammate@example.com" id="inviteEmail">


            <label style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 8px; display: block;">Permission Level</label>
            <select class="studio-select" style="margin-bottom: 20px;">
                <option>Can View Only</option>
                <option selected>Can Edit</option>
                <option>Admin (Full Access)</option>
            </select>


            <button class="action-btn" onclick="sendInvite()">Send Invitation</button>
        </div>
    </div>


    <!-- Notification Toast -->
    <div class="notification" id="notification"></div>


    <script>
        // =====================================================
        // STATE MANAGEMENT
        // =====================================================
        let appState = {
            tokens: 850,
            maxTokens: 1000,
            sessionTime: 2538,
            estimatedCost: 45,
            quality: 'production',
            zoom: 1
        };

        // Image adjustment state
        let adjustments = {
            brightness: 100,
            contrast: 100,
            saturate: 100,
            'hue-rotate': 0,
            blur: 0,
            sepia: 0,
            grayscale: 0,
            sharpness: 0,
            vignette: 0,
            warmth: 0,
            tint: 0,
            lightWarmth: 50,
            shadow: 50,
            exposure: 100
        };

        // History for undo/redo
        let history = [];
        let historyIndex = -1;
        const MAX_HISTORY = 30;

        function saveToHistory() {
            // Remove any forward history
            history = history.slice(0, historyIndex + 1);
            history.push(JSON.parse(JSON.stringify(adjustments)));
            if (history.length > MAX_HISTORY) history.shift();
            historyIndex = history.length - 1;
        }

        // =====================================================
        // CORE FILTER ENGINE - applies all adjustments to image
        // =====================================================
        function buildFilterString() {
            const a = adjustments;
            let filters = [];
            if (a.brightness !== 100) filters.push(`brightness(${a.brightness}%)`);
            if (a.contrast !== 100) filters.push(`contrast(${a.contrast}%)`);
            if (a.saturate !== 100) filters.push(`saturate(${a.saturate}%)`);
            if (a['hue-rotate'] !== 0) filters.push(`hue-rotate(${a['hue-rotate']}deg)`);
            if (a.blur > 0) filters.push(`blur(${a.blur}px)`);
            if (a.sepia > 0) filters.push(`sepia(${a.sepia / 100})`);
            if (a.grayscale > 0) filters.push(`grayscale(${a.grayscale / 100})`);
            // Warmth: sepia-like tint using hue + saturate combination
            // handled via color overlay
            filters.push('drop-shadow(0 20px 40px rgba(0,0,0,0.5))');
            return filters.join(' ');
        }

        function applyFilters() {
            const img = document.getElementById('modelImage');
            img.style.filter = buildFilterString();
            updateWarmthOverlay();
            updateTintOverlay();
            updateVignetteOverlay();
        }

        function updateWarmthOverlay() {
            const overlay = document.getElementById('colorTintOverlay');
            const w = adjustments.warmth;
            if (w > 0) {
                // Warm (orange tint)
                overlay.style.background = `rgba(255, 147, 41, ${w / 400})`;
                overlay.style.mixBlendMode = 'soft-light';
                overlay.style.opacity = '1';
            } else if (w < 0) {
                // Cool (blue tint)
                overlay.style.background = `rgba(41, 128, 255, ${Math.abs(w) / 400})`;
                overlay.style.mixBlendMode = 'soft-light';
                overlay.style.opacity = '1';
            } else {
                overlay.style.opacity = '0';
            }
        }

        function updateTintOverlay() {
            // tint is handled via hue overlay if needed
        }

        function updateVignetteOverlay() {
            const overlay = document.getElementById('vignetteOverlay');
            const v = adjustments.vignette;
            if (v > 0) {
                const spread = 100 - v;
                overlay.style.background = `radial-gradient(ellipse at center, transparent ${spread * 0.5}%, rgba(0,0,0,${v / 100}) 100%)`;
                overlay.style.opacity = '1';
            } else {
                overlay.style.opacity = '0';
            }
        }

        // =====================================================
        // ADJUSTMENT FUNCTIONS
        // =====================================================
        function updateAdjustment(slider, property, valId, unit) {
            const value = parseFloat(slider.value);
            adjustments[property] = value;
            if (valId) {
                const el = document.getElementById(valId);
                if (el) el.textContent = value + unit;
            }
            applyFilters();
        }

        function updateSharpness(slider) {
            const value = parseFloat(slider.value);
            adjustments.sharpness = value;
            document.getElementById('sharpnessVal').textContent = value + '%';
            // Sharpness via contrast + saturation boost
            const img = document.getElementById('modelImage');
            const sharpContrast = 100 + (value * 0.5);
            adjustments.contrast = sharpContrast;
            document.getElementById('contrastSlider').value = sharpContrast;
            document.getElementById('contrastVal').textContent = Math.round(sharpContrast) + '%';
            applyFilters();
        }

        function updateVignette(slider) {
            const value = parseFloat(slider.value);
            adjustments.vignette = value;
            document.getElementById('vignetteVal').textContent = Math.round(value) + '%';
            updateVignetteOverlay();
        }

        function updateWarmth(slider) {
            const value = parseFloat(slider.value);
            adjustments.warmth = value;
            document.getElementById('warmthVal').textContent = (value >= 0 ? '+' : '') + Math.round(value) + '%';
            applyFilters();
        }

        function updateTint(slider) {
            const value = parseFloat(slider.value);
            adjustments.tint = value;
            document.getElementById('tintVal').textContent = (value >= 0 ? '+' : '') + Math.round(value) + '%';
            // Tint shifts hue slightly
            adjustments['hue-rotate'] = value * 0.5;
            document.getElementById('hueSlider').value = adjustments['hue-rotate'];
            document.getElementById('hueVal').textContent = Math.round(adjustments['hue-rotate']) + 'Â°';
            applyFilters();
        }

        function updateLightWarmth(slider) {
            const value = parseFloat(slider.value);
            adjustments.lightWarmth = value;
            document.getElementById('lightWarmthVal').textContent = Math.round(value) + '%';
            // Warmth from lighting affects brightness + sepia slightly
            const sepiaAmount = value * 0.15;
            adjustments.sepia = sepiaAmount;
            document.getElementById('sepiaSlider').value = sepiaAmount;
            document.getElementById('sepiaVal').textContent = Math.round(sepiaAmount) + '%';
            applyFilters();
        }

        function updateLightSoftness(slider) {
            const value = parseFloat(slider.value);
            document.getElementById('softVal').textContent = Math.round(value) + '%';
            // Soft light = very slight blur + brightness boost
            adjustments.blur = value * 0.03;
            adjustments.brightness = 100 + (value * 0.1);
            document.getElementById('blurSlider').value = adjustments.blur;
            document.getElementById('blurVal').textContent = adjustments.blur.toFixed(1) + 'px';
            document.getElementById('brightnessSlider').value = adjustments.brightness;
            document.getElementById('brightnessVal').textContent = Math.round(adjustments.brightness) + '%';
            applyFilters();
        }

        function updateShadow(slider) {
            const value = parseFloat(slider.value);
            adjustments.shadow = value;
            document.getElementById('shadowVal').textContent = Math.round(value) + '%';
            // Higher shadow = lower brightness in darker areas = lower overall contrast
            adjustments.contrast = 100 + ((value - 50) * 0.4);
            document.getElementById('contrastSlider').value = adjustments.contrast;
            document.getElementById('contrastVal').textContent = Math.round(adjustments.contrast) + '%';
            applyFilters();
        }

        // =====================================================
        // BACKGROUND FUNCTIONS
        // =====================================================
        const backgrounds = {
            studio: '#1a1a1a',
            urban: 'linear-gradient(135deg, #2c3e50, #3d4f61)',
            runway: 'linear-gradient(180deg, #0a0a0a 0%, #2a2a2a 100%)',
            lifestyle: 'linear-gradient(135deg, #c8b8a2, #e8ddd0)',
            transparent: 'repeating-conic-gradient(#333 0% 25%, #222 0% 50%) 0 0 / 20px 20px',
            custom: null
        };

        function setBackground(btn, type) {
            const grid = btn.closest('.btn-grid');
            grid.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const viewport = document.getElementById('viewport');
            if (type === 'custom') {
                // open color picker
                const picker = document.createElement('input');
                picker.type = 'color';
                picker.value = '#1a1a1a';
                picker.style.display = 'none';
                document.body.appendChild(picker);
                picker.click();
                picker.oninput = (e) => {
                    viewport.style.background = e.target.value;
                };
                picker.onchange = () => picker.remove();
            } else {
                viewport.style.background = backgrounds[type] || '#1a1a1a';
            }
            updateTokenCost();
        }

        function setBgColor(swatch, color) {
            document.querySelectorAll('.bg-swatch').forEach(s => s.classList.remove('active'));
            swatch.classList.add('active');
            document.getElementById('viewport').style.background = color;
        }

        // =====================================================
        // LIGHTING PRESETS
        // =====================================================
        const lightingPresets = {
            studio: { brightness: 100, contrast: 110, saturate: 95, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: 0 },
            natural: { brightness: 108, contrast: 98, saturate: 105, 'hue-rotate': 5, sepia: 5, grayscale: 0, blur: 0, warmth: 15 },
            dramatic: { brightness: 85, contrast: 150, saturate: 80, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: -10 },
            soft:     { brightness: 115, contrast: 88, saturate: 90, 'hue-rotate': 0, sepia: 8, grayscale: 0, blur: 0.3, warmth: 20 },
            golden:   { brightness: 112, contrast: 105, saturate: 120, 'hue-rotate': 15, sepia: 25, grayscale: 0, blur: 0, warmth: 60 },
            highkey:  { brightness: 140, contrast: 95, saturate: 85, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: 5 }
        };

        function applyLightingPreset(btn, preset) {
            const grid = btn.closest('.btn-grid');
            grid.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            saveToHistory();
            const p = lightingPresets[preset];
            Object.assign(adjustments, p);
            syncSlidersToState();
            applyFilters();
            showNotification(`Applied ${preset} lighting`);
        }

        // =====================================================
        // LOOK PRESETS (scene panel)
        // =====================================================
        const lookPresets = {
            editorial: { brightness: 105, contrast: 115, saturate: 85, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: -5 },
            cinematic: { brightness: 90, contrast: 130, saturate: 75, 'hue-rotate': 200, sepia: 10, grayscale: 0, blur: 0, warmth: -20 },
            fashion:   { brightness: 110, contrast: 108, saturate: 110, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: 10 },
            moody:     { brightness: 80, contrast: 140, saturate: 60, 'hue-rotate': 195, sepia: 15, grayscale: 10, blur: 0, warmth: -30 },
            bright:    { brightness: 130, contrast: 90, saturate: 110, 'hue-rotate': 0, sepia: 5, grayscale: 0, blur: 0, warmth: 25 },
            bw:        { brightness: 105, contrast: 120, saturate: 0, 'hue-rotate': 0, sepia: 0, grayscale: 100, blur: 0, warmth: 0 },
            vintage:   { brightness: 100, contrast: 95, saturate: 80, 'hue-rotate': 0, sepia: 40, grayscale: 0, blur: 0, warmth: 35 },
            reset:     { brightness: 100, contrast: 100, saturate: 100, 'hue-rotate': 0, sepia: 0, grayscale: 0, blur: 0, warmth: 0, vignette: 0, tint: 0, sharpness: 0 }
        };

        function applyLookPreset(btn, preset) {
            if (preset !== 'reset') {
                const grid = btn.closest('.btn-grid');
                grid.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            saveToHistory();
            const p = lookPresets[preset];
            Object.assign(adjustments, p);
            syncSlidersToState();
            applyFilters();
            showNotification(preset === 'reset' ? 'Adjustments reset' : `Applied ${preset} look`);
        }

        function resetAllAdjustments() {
            saveToHistory();
            adjustments = { brightness: 100, contrast: 100, saturate: 100, 'hue-rotate': 0,
                blur: 0, sepia: 0, grayscale: 0, sharpness: 0, vignette: 0, warmth: 0,
                tint: 0, lightWarmth: 50, shadow: 50, exposure: 100 };
            syncSlidersToState();
            applyFilters();
            showNotification('All adjustments reset');
        }

        function syncSlidersToState() {
            const a = adjustments;
            const set = (id, val, displayId, unit, decimals = 0) => {
                const el = document.getElementById(id);
                const displayEl = document.getElementById(displayId);
                if (el) el.value = val;
                if (displayEl) displayEl.textContent = (Number.isFinite(val) ? val.toFixed(decimals) : val) + unit;
            };
            set('brightnessSlider', a.brightness, 'brightnessVal', '%');
            set('contrastSlider', a.contrast, 'contrastVal', '%');
            set('saturationSlider', a.saturate, 'saturationVal', '%');
            set('hueSlider', a['hue-rotate'], 'hueVal', 'Â°');
            set('blurSlider', a.blur, 'blurVal', 'px', 1);
            set('sepiaSlider', a.sepia, 'sepiaVal', '%');
            set('grayscaleSlider', a.grayscale, 'grayscaleVal', '%');
            set('vignetteSlider', a.vignette, 'vignetteVal', '%');
            set('warmthSlider', a.warmth, 'warmthVal', '%');
        }

        // =====================================================
        // SESSION TIMER
        // =====================================================
        function updateSessionTimer() {
            const minutes = Math.floor(appState.sessionTime / 60);
            const seconds = appState.sessionTime % 60;
            document.getElementById('sessionTimer').textContent =
                `${minutes}:${seconds.toString().padStart(2, '0')} remaining`;
            if (appState.sessionTime > 0) appState.sessionTime--;
        }
        setInterval(updateSessionTimer, 1000);

        // =====================================================
        // TOKEN MANAGEMENT
        // =====================================================
        function updateTokenDisplay() {
            const percentage = (appState.tokens / appState.maxTokens) * 100;
            document.getElementById('tokenCount').textContent = `${appState.tokens} / ${appState.maxTokens}`;
            document.getElementById('tokenBar').style.width = percentage + '%';
        }

        function updateTokenCost() {
            let baseCost = 20;
            const bodyCustomization = document.querySelectorAll('#modelLeftPanel .slider-control').length * 3;
            const physics = document.querySelectorAll('#garmentLeftPanel input[type="checkbox"]:checked').length * 2.5;
            const qualityMultiplier = { draft: 1, production: 1.5, print: 2.5 };
            const totalCost = Math.round((baseCost + bodyCustomization + physics) * qualityMultiplier[appState.quality]);
            appState.estimatedCost = totalCost;
            document.getElementById('estimatedCost').textContent = totalCost + ' tokens';
        }

        // =====================================================
        // PANEL SWITCHING
        // =====================================================
        function switchPanel(event, panelName) {
            document.querySelectorAll('.panel-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.panel-content').forEach(panel => panel.classList.remove('active'));
            document.getElementById(panelName + 'Panel').classList.add('active');
        }

        function switchLeftPanel(event, panelName) {
            document.querySelectorAll('.left-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.left-panel-content').forEach(panel => panel.classList.remove('active'));
            document.getElementById(panelName + 'LeftPanel').classList.add('active');
        }

        // =====================================================
        // SLIDER DISPLAY UPDATES (existing display logic)
        // =====================================================
        function updateSlider(slider, type) {
            const value = parseFloat(slider.value);
            const valueSpan = slider.previousElementSibling.querySelector('.slider-value');
            switch(type) {
                case 'height':
                    const feet = Math.floor(value / 12);
                    const inches = value % 12;
                    valueSpan.textContent = `${feet}'${inches}"`;
                    break;
                case 'bust': case 'waist': case 'hips':
                    valueSpan.textContent = value + '"'; break;
                case 'degrees':
                    valueSpan.textContent = value + 'Â°'; break;
                case 'percentage':
                    valueSpan.textContent = value + '%'; break;
                case 'weight':
                    valueSpan.textContent = `${value}/${100-value}`; break;
                case 'skin':
                    const tones = ['Very Light','Light','Medium','Tan','Dark','Very Dark'];
                    valueSpan.textContent = tones[Math.floor((value/100)*(tones.length-1))]; break;
                default:
                    valueSpan.textContent = value;
            }
        }

        // =====================================================
        // GRID BUTTON SELECTION
        // =====================================================
        function selectGridBtn(btn) {
            const grid = btn.closest('.btn-grid');
            grid.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateTokenCost();
        }

        // =====================================================
        // MODEL SELECTION
        // =====================================================
        function selectModel(card) {
            document.querySelectorAll('.model-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            showNotification('Model selected');
        }

        // =====================================================
        // GARMENT COLOR
        // =====================================================
        function selectColor(swatch, color) {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            swatch.classList.add('active');
            document.querySelector('.color-input').value = color;
            applyGarmentColor(color);
        }

        function updateGarmentColor(input) {
            applyGarmentColor(input.value);
            showNotification('Garment color updated');
        }

        function applyGarmentColor(color) {
            // Shift hue of the image to simulate color change
            // Parse hex to HSL to determine hue shift
            const r = parseInt(color.slice(1,3),16)/255;
            const g = parseInt(color.slice(3,5),16)/255;
            const b = parseInt(color.slice(5,7),16)/255;
            const max = Math.max(r,g,b), min = Math.min(r,g,b);
            let h = 0;
            if (max !== min) {
                const d = max - min;
                switch(max) {
                    case r: h = ((g-b)/d + (g<b?6:0)) / 6; break;
                    case g: h = ((b-r)/d + 2) / 6; break;
                    case b: h = ((r-g)/d + 4) / 6; break;
                }
            }
            const targetHue = Math.round(h * 360);
            const currentHue = 0; // base image hue reference
            showNotification('Garment color applied');
        }

        // =====================================================
        // VIEW SELECTION
        // =====================================================
        function selectView(btn, view) {
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const img = document.getElementById('modelImage');
            // Simulate view change with transform
            const transforms = {
                front: 'scale(1) rotateY(0deg)',
                side: 'scale(0.85) rotateY(25deg)',
                back: 'scale(1) rotateY(180deg)',
                'three-quarter': 'scale(0.9) rotateY(35deg)'
            };
            img.style.transform = `scale(${appState.zoom}) ${transforms[view].replace('scale(1) ','').replace('scale(0.85) ','').replace('scale(0.9) ','')}`;
            showNotification(`Switched to ${view} view`);
        }

        // =====================================================
        // OVERLAY TOGGLES
        // =====================================================
        function toggleOverlay(btn, overlay) {
            btn.classList.toggle('active');
            const isOn = btn.classList.contains('active');
            const viewport = document.getElementById('viewport');
            if (overlay === 'guides' && isOn) {
                viewport.style.backgroundImage = 'linear-gradient(rgba(220,20,60,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(220,20,60,0.1) 1px, transparent 1px)';
                viewport.style.backgroundSize = '50px 50px';
            } else if (overlay === 'guides' && !isOn) {
                viewport.style.backgroundImage = '';
                viewport.style.backgroundSize = '';
            }
            showNotification(`${overlay} overlay ${isOn ? 'enabled' : 'disabled'}`);
        }

        // =====================================================
        // QUALITY
        // =====================================================
        function updateQuality(select) {
            appState.quality = select.value;
            updateTokenCost();
            showNotification(`Quality set to ${select.value}`);
        }

        // =====================================================
        // CANVAS CONTROLS (UNDO/REDO/ZOOM)
        // =====================================================
        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                adjustments = JSON.parse(JSON.stringify(history[historyIndex]));
                syncSlidersToState();
                applyFilters();
                showNotification('Undone');
            } else {
                showNotification('Nothing to undo');
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                adjustments = JSON.parse(JSON.stringify(history[historyIndex]));
                syncSlidersToState();
                applyFilters();
                showNotification('Redone');
            } else {
                showNotification('Nothing to redo');
            }
        }

        function resetCanvas() {
            saveToHistory();
            resetAllAdjustments();
            appState.zoom = 1;
            const img = document.getElementById('modelImage');
            img.style.transform = 'scale(1)';
            document.getElementById('viewport').style.background = '';
            showNotification('Canvas reset');
        }

        function zoomIn() {
            appState.zoom = Math.min(appState.zoom * 1.2, 3);
            document.getElementById('modelImage').style.transform = `scale(${appState.zoom})`;
        }

        function zoomOut() {
            appState.zoom = Math.max(appState.zoom / 1.2, 0.5);
            document.getElementById('modelImage').style.transform = `scale(${appState.zoom})`;
        }

        function fitView() {
            appState.zoom = 1;
            document.getElementById('modelImage').style.transform = 'scale(1)';
            showNotification('View fit to canvas');
        }

        // =====================================================
        // FILE UPLOAD
        // =====================================================
        function handleGarmentUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                showNotification(`Uploaded: ${file.name}`);
                // If image file, show it as the model preview
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('modelImage').src = e.target.result;
                        applyFilters();
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // =====================================================
        // AI ENHANCE
        // =====================================================
        function aiEnhance() {
            showLoading();
            saveToHistory();
            setTimeout(() => {
                // AI enhance = smart auto adjustments
                adjustments.brightness = 108;
                adjustments.contrast = 112;
                adjustments.saturate = 115;
                adjustments.sharpness = 20;
                syncSlidersToState();
                applyFilters();
                hideLoading();
                showNotification('AI Enhancement applied âœ¨');
            }, 1800);
        }

        // =====================================================
        // MODALS
        // =====================================================
        function showModal(id) { document.getElementById(id).classList.add('show'); }
        function hideModal(id) { document.getElementById(id).classList.remove('show'); }
        function showRenderModal() { updateTokenCost(); showModal('renderModal'); }
        function showVersionModal() { showModal('versionModal'); }
        function showTeamModal() { showModal('teamModal'); }

        // =====================================================
        // RENDER & EXPORT
        // =====================================================
        function startRender() {
            hideModal('renderModal');
            showLoading();
            setTimeout(() => {
                appState.tokens -= appState.estimatedCost;
                updateTokenDisplay();
                hideLoading();
                showNotification('Render complete! âœ¨');
            }, 3000);
        }

        function exportRender() {
            let multiplier = 1;
            if (document.getElementById('exportColors').checked) multiplier *= 6;
            if (document.getElementById('exportAngles').checked) multiplier *= 4;
            if (document.getElementById('exportSizes').checked) multiplier *= 9;
            const totalCost = appState.estimatedCost * multiplier;
            if (confirm(`Export ${multiplier} renders for ${totalCost} tokens?`)) {
                showLoading();
                setTimeout(() => {
                    appState.tokens -= totalCost;
                    updateTokenDisplay();
                    hideLoading();
                    showNotification(`${multiplier} renders exported! ðŸ“¥`);
                }, 2000);
            }
        }

        function saveVersion() { showNotification('Version saved âœ“'); }

        function sendInvite() {
            const email = document.getElementById('inviteEmail').value;
            if (email) {
                hideModal('teamModal');
                showNotification(`Invitation sent to ${email}`);
                document.getElementById('inviteEmail').value = '';
            }
        }

        // =====================================================
        // NOTIFICATIONS
        // =====================================================
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 2500);
        }

        function showLoading() { document.getElementById('loadingOverlay').classList.add('show'); }
        function hideLoading() { document.getElementById('loadingOverlay').classList.remove('show'); }

        // Modal click outside to close
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('show');
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z') { e.preventDefault(); undo(); }
                if (e.key === 'y') { e.preventDefault(); redo(); }
                if (e.key === 's') { e.preventDefault(); saveVersion(); }
                if (e.key === '=') { e.preventDefault(); zoomIn(); }
                if (e.key === '-') { e.preventDefault(); zoomOut(); }
                if (e.key === '0') { e.preventDefault(); fitView(); }
            }
        });

        // =====================================================
        // INITIALIZE
        // =====================================================
        updateTokenDisplay();
        updateTokenCost();
        saveToHistory(); // save initial state
        applyFilters();  // apply default filter stack

    </script>
</body>
</html>
